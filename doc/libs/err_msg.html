<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>NCBI C++ error handling and diagnostics</title>
  </head>

  <body>
	 <h1>NCBI C++ error handling and diagnostics</h1>

	 <ul>
		<li> <a href="#ref_Assert">
		  Debug-mode(internal use) checks and diagnostics</a>
		<li> <a href="#ref_Exception">
		  C++ exceptions</a>
		<li> <a href="#ref_Message">
		  Standard NCBI C++ message posting</a>
	 </ul>


	 <br></br>
	 <a name="ref_Assert"><h2>Debug-mode(internal use) checks and diagnostics</h2></a>

	 <p> <i>#include &lt;ncbidbg.hpp&gt;</i>

	 <p>
	 There are 4 preprocessor macros
	 (<i>_TROUBLE</i>, <i>_ASSERT</i>, <i>_VERIFY</i> and <i>_TRACE</i>)
	 to help the developer to catch some (logical) errors on the
	 early stages of code development and to hardcode some
	 assertions on the code and data behaviour for internal use.
	 All these macros gets disabled in the non-debug versions lest
	 to affect the application performance and functionality;  to
	 turn them on, one must <i>#define</i> the <i>"_DEBUG"</i> preprocessor
	 variable. Also, the developer must be careful and not use
	 any code with side effects in <i>_ASSERT</i> or <i>_TRACE</i>
	 as this will cause a discrepancy in functionality between debug
	 and non-debug code(e.g., <i>_ASSERT(a++)</i> and
	 <i>_TRACE("a++ = " &lt;&lt; a++)</i> would increment <i>"a"</i>
	 in the debug version but do nothing in the non-debug one).
	 <ul>
		<li> <b><i>_TROUBLE</i></b> --
		Has absolutely no effect if <i>"_DEBUG"</i> is not defined;
		otherwise, unconditionally halt the application.

		<li> <b><i>_ASSERT(expr)</i></b> --
		Has absolutely no effect if <i>"_DEBUG"</i> is not defined;
		otherwise, evaluate expression <b><i>expr</i></b> and halt the
		application if <b><i>expr</i></b> resulted in zero(or <i>"false"</i>).

		<li> <b><i>_VERIFY(expr)</i></b> --
		Evaluate expression <b><i>expr</i></b> and, if <i>"_DEBUG"</i> is defined
		and <b><i>expr</i></b> resulted in zero(or <i>"false"</i>) then halt the
		application.
		
		<li> <b><i>_TRACE(message)</i></b> --
		Has absolutely no effect if <i>"_DEBUG"</i> is not defined;
		otherwise, it outputs the <b><i>message</i></b> using
		<a href="#ref_Message">Standard NCBI C++ message posting</a>:
	 </ul> </ul>

	 All these macros automatically add(prefix) file name and line
	 number to the diagnostics. For example, this code located in file
	 <i>"somefile.cpp"</i> at line 333:
<pre>
int x = 100;
_TRACE( "x + 5 = "  <<  (x + 5) );
</pre>
	 will output:
<pre>
{somefile.cpp:333}  x + 5 = 105
</pre>


	 <br></br>
	 <a name="ref_Exception"><h2>C++ exceptions</h2></a>

	 <p> <i>#include &lt;ncbiexpt.hpp&gt;</i>

	 <p>
	 One must use one of
	 <a href="http://www.cygnus.com/misc/wp/dec96pub/lib-diagnostics.html#lib.std.exceptions">standard C++ exceptions</a>
	 as much as possible.
	 
	 <p>
	 Then, it is <b>strictly recommended</b> that when the basic functionality
	 provided by standard C++ exceptions is unsufficient for some reason,
	 one must derive the new ad hoc exception classes from one of the
	 standard exception classes.	-- This is to provide a more uniform way
	 of exceprion handling, for we could smartly catch/handle most of
	 thrown exceptions using a STD_CATCH macro like:

<pre>
// Standard handling of "exception"-derived exceptions
#define STD_CATCH(message) \
catch (exception& e) { \
    CNcbiDiag diag; \
    diag << Error << "[" << message << "]" << "Exception: " << e.what(); \
}

// Standard handling of "exception"-derived and all other exceptions
#define STD_CATCH_ALL(message) \
STD_CATCH(message) \
catch (...) { \
    CNcbiDiag diag; \
    diag << Error << "[" << message << "]" << "Unknown exception"; \
}
</pre>
	 This way, the standard way of dealing with exception in the NCBI C++
	 code will be like:
<pre>
class foreign_exception { ..... };
class exception_derived_user : public exception { ..... };
...........
try {
   SomeFunc("qq", 5);
} catch (foreign_exception& fe) {
   // do something special with some(not derived from "exception") exception
} catch (exception_derived_user& eu)  {
   // do something with "NCBI-standard"(derived from "exception") exception
}
// standard handling for all the rest "NCBI-standard" exceptions
STD_CATCH("It happened inside SomeFunc()...");
</pre>


	 <br></br>
	 <a name="ref_Message"><h2>Standard NCBI C++ message posting</h2></a>

	 <p> <i>#include &lt;ncbidiag.hpp&gt;</i>

	 <p>



	 <br></br>
	 <hr>
	 <table border=0 width="100%" cellspacing=0>
		<tr>
		  <td><address><a href="mailto:vakatov@ncbi.nlm.nih.gov">Denis Vakatov</a></address></td>
		  <td align=right>($Revision$)</td></tr>
	 </table>
  </body>
</html>
