<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>Installation and configuration</title>
</head>

<body>
<h1>Installation and configuration</h1>



<ul>
  <li> <a href="#ref_Source">
       NCBI C++ source code repository</a> 
  <li> <a href="#ref_Configure">
       Configuration and installation script <b><i>configure</i></b></a>
  <li> <a href="#ref_Build">
		  Structure of the build directory tree produced by <b><i>configure</i></b></a>
  <li> <a href="#ref_Running">
       Running the <b><i>configure</i></b> script</a>
  <li> <a href="#ref_Reconf">
       Quick reconfiguration</a>
  <li> <a href="#ref_Preset">
       Preset platform-specific features for the <b><i>configure</i></b> script
	 </a>
  <li> <a href="#ref_Example">
       An example of configuration, installation and build</a>
  <li> <a href="#ref_Compilers">
       List of supported compilers</a>
  <li> <a href="#ref_AdHoc">
       Ad-hoc installations</a>
	 <ul>
		<li> <a href="#ref_MsvcProj">
		  MS Visual C++ workspace</a>
	 </ul>
  </ul>

<p>
This page describes how to get the NCBI C++ sources and how to deploy
a build directory(es) that has the <i>"ncbiconf.h"</i> header and makefiles
configured to work with the platform and compiler(and its flags) you are using.

<br></br>
<a name="ref_Source">
<h2>NCBI C++ source code repository</h2>
</a>

<p>
The NCBI C++ sources can be obtained from internal NCBI
CVS tree (<i><b>"$CVSROOT/internal/c++/"</b></i>) or
from a distribution archive. In either case, the root directory will
contain the <a href="src_tree.gif"><i>NCBI C++  source tree</i></a>:
<ul>
  <li> Set of files needed for the platform-specific
		 <a href="#ref_Running">configuration and installation</a>
		 with the
       <a href="http://sunland.gsfc.nasa.gov/info/autoconf/Top.html">
       autoconf</a> utility.
       It includes pre-built multiplatform <i>"configure"</i> script and its
       <a href="#ref_Preset">platform-specific "wrappers"</a>
       in the <i><b>"compilers/"</b></i> directory.
       Here is also a template for the configuration header file
       <i>"config.h.in"</i> and
       <a href="#ref_PreBuiltHeaders">pre-built configuration headers</a>
       (<i>"ncbiconf.*"</i>) for some platforms.

  <li> <i><b>"doc/"</b></i> directory. -- 
       Here go the generic NCBI C++ documentation, manuals(e.g. including
       this one <i>"doc/config.html"</i>) and guidelines for
       <b>everybody</b> writing on C++ in NCBI SWG.

  <li> <i><b>"src/"</b> and <b>"include/"</b></i> directories. --
       These two contain a hierarchical directory tree of
       <a href="new_proj.html">NCBI C++ projects</a>
       , so that each project has its source and header directories
       mirrored (e.g. <i>"src/corelib/" correstonds to "include/corelib/"</i>).
       The <i><b>"src/"</b></i> directory also contains generic makefile
       templates (<i>"src/Makefile.*.in</i>") and configurable makefiles for
       each project or sub-project
       (like e.g. <i>"src/corelib/Makefile.*.in"</i>
       and <i>"src/corelib/test/Makefile.*.in"</i>).
</ul>


<a name="ref_Configure">
<h2>Configuration and installation script <b><i>configure</i></b></h2>
</a>

<p>
Practically every compiler compiles C++ (and even C!) code differently --
different compilers may vary in the OS standard libraries and header files,
completeness of the C++ implementation, and... in compiler bugs.
There are also different <b><i>make</i></b> tools and file naming conventions
on different platforms.

<p>
Thus, a configuration is needed to encounter the said platform-
and compiler-specific features.
For this purporse, we are using GNU
<a href="http://sunland.gsfc.nasa.gov/info/autoconf/Top.html">autoconf</a> 
tool to automatically generate compiler-specific header file
<i>"ncbiconf.h"</i> and makefiles that would work for the given platform.

<p>
User performs both configuration and installation by merely running
platform-independent(<i>sh, bash</i>) shell script
<b><i>configure</i></b> (generated by
<a href="http://sunland.gsfc.nasa.gov/info/autoconf/Top.html">
autoconf</a>
from template <i>"configure.in"</i>) from the NCBI C++ top source directory.

<p>
During the configuration process, many compiler "features" are tested,
and the results of this testing are recorded in the configuration header
<i>"ncbiconf.h"</i> by the means of C preprocessor variables. E.g., the
preprocessor variable <i>"NO_INCLASS_TMPL"</i> indicates whether the tested
compiler supports template class methods; another example of the information 
contained in <i>"ncbiconf.h"</i> are preprocessor variables used to
define <a href="types.html#ref_IntFixed">sized integer</a> and
<a href="types.html#ref_BigScalar"><i>BigScalar</i></a> types.

<p>
The <b><i>configure</i></b> script will create so-called
<a href="bld_tree.gif"><i>build tree</i></a>
-- a hierarchy of directories where
object modules, libraries and executables are to be built.
User can create as many such trees as he needs.  All these
trees would refer to just the same (origin) NCBI C++ 
<a href="src_tree.gif"><i>source tree</i></a>,
while each <i>build tree</i> can contain its own (compilator-specific)
<i>"ncbiconf.h"</i> header, and/or different set of compilation/linking/etc.
flags and tools ("frozen" in the makefiles). This is to allow one to build
libraries and executables using different compilers and/or flags, yet from
the same sources, and in a uniform way.


<br></br>
<a name="ref_Build">
<h2>Structure of the build directory tree(s) produced by <b><i>configure</i></b></h2>
</a>

<p>
Each configuration process results in a new tree of build directories.
The structure of the tree is as follows(see also in
<a href="bld_tree.gif">chart</a>):
<ul>
  <li> <i><b>"inc/"</b></i> -- contains
       <i>"ncbiconf.h"</i> configuration header generated by the
       <b><i>configure</i></b> script.
  <li> <i><b>"build/"</b></i> -- contains a hierarchy of directories that
       correspond to those in the <i><b>"src/"</b></i> (in NCBI C++ original
       sources). These directories will contain makefiles (<i>"Makefile.*"</i>)
       generated by the <b><i>configure</i></b> script from the makefile
       templates (<i>"Makefile.*.in"</i>) of corresponding project.
       The makefiles will have all tools and flags set as they were
       specified for the configuration process, and they will keep referencies
       to the original NCBI C++ source directories.
       All build results (object modules, libraries and executables
       as well as any auxiliary files and directories created during the build)
       will go exclusively into this <i><b>"build/"</b></i> tree, and not
       to the original NCBI C++ source directories. This allows one to
       have several build directories that use just the same sources, but
       compile and link them with different flags and/or compilers.
  <li> <i><b>"lib/"</b></i> -- here go all public libraries built by the
       <i><b>"build/"</b></i>-located projects.
  <li> <i><b>"bin/"</b></i> -- here go all public executables built by the
       <i><b>"build/"</b></i>-located projects.
  <li> <i><b>"status/"</b></i> -- contains cache (<i>"config.cache"</i>),
       log file (<i>"config.log"</i>), and secondary confifuration script
       (<i>"config.status"</i>) produced by <b><i>configure</i></b> during
       the configuration process.
</ul>


<a name="ref_Running">
<h2>Running the <b><i>configure</i></b> script</h2>
</a>

<p>
By default, the configuration process will produce a <i>build tree</i>
in the <i><b>"exec/"</b></i> subdirectory of the source root directory.
However, one can alternate its location by specifying optional
parameter <i>"--exec_prefix"</i> to the <b><i>configure</i></b>
script. For example, <i>"configure --exec_prefix=my_foo_dir"</i> would deploy
the build tree into directory <i>"my_foo_dir"</i>.
There is a "special case"(<i>"configure --exec_prefix=."</i>) -- for the people
who usually do not need different builds, and who prefer to have object
files, libraries and executables where the sources are located.

<p>
<a name="ref_RunningFlags"></a>
User can specify C and C++ compilers to use by setting environment variables
<b>CC</b> and <b>CXX</b> for the <b><i>configure</i></b> script.
By default, they will be (in the order of priority):
<b><i>c++,g++,gcc,CC,cxx,cc++</i></b> and <b><i>gcc,cc</i></b>, respectively.

<p>
Other tools and flags can be specified via the following shell
environment variables:
<ul>
  <li> <b>CPP</b> -- C preprocessor;  "$CXX -E" or "$CC -E" by default
  <li> <b>AR</b> -- "ar" by default
  <li> <b>RANLIB</b> -- "ranlib"(":" if "ranlib" not found) by default
  <li> <b>STRIP</b> -- "strip"(":" if "strip" not found) by default
  <li> <b>CFLAGS</b> -- C compiler flags
  <li> <b>CXXFLAGS</b> -- C++ compiler flags
  <li> <b>CPPFLAGS</b> -- C preprocessor flags
  <li> <b>LDFLAGS</b> -- linker flags
  <li> <b>LIBS</b> -- standard libraries to be linked to every executable
</ul>

These flags will be used to:
<ul>
  <li> Compile C sources:  <b><i>$CC -c $CFLAGS $CPPFLAGS ...</i></b>
  <li> Compile C++ sources:  <b><i>$CXX -c $CXXFLAGS $CPPFLAGS ...</i></b>
  <li> Link:  <b><i>$CXX $LDFLAGS ... $LIBS</i></b>
</ul>

For more info on these variables see in the
<a href="http://sunland.gsfc.nasa.gov/info/autoconf/Preset_Output_Variables.html">autoconf documentation</a>.
The specified tools and flags will then be "frozen" inside the makefiles of
produced <i>build tree</i>.

<a name="ref_Reconf">
<h2>Quick reconfiguration</h2>
</a>

<p>
Sometimes, you do changes in your existing <i>"*.in"</i> files (e.g. makefiles)
in the <i>source tree</i>, and you want to reflect these changes in your
<i>build tree</i>. To do this, just go to the <i><b>"status/"</i></b> subdirectory
of the relevant <i>build tree</i> and run <i><b>config.status</i></b> script
in it.

<p>
This technique also helps if some <i>"*.in"</i> files have been modified
in the result of CVS update in your <i>source tree</i>.

<p>
If you <b>added</b> or <b>removed</b> any of <i>"*.in"</i> files then you must
reconfigure your <i>build tree</i> anew by calling the configuration script
again, just like you did it for the original configuration.
(NOTE: In this case, you must also manualy remove the appropriate
<i>"inc/ncbiconf.h"</i> file before running the configure script.)


<br></br>
<a name="ref_Preset">
<h2>Preset platform-specific features for the <b><i>configure</i></b> script</h2>
</a>

<p>
For the developer's convenience, there is an auxiliary script
<b><i>configure.sh</i></b>. It provides some platform-specific pre-configuration
that cannot be performed automatically -- such like installing local paths
and compiler-specific flags. This script uses <b><i>compilers/*.env</i></b>
sub-scripts to retrieve these local paths and flags. The following localization
variables can be set in addition to the "generic" ones(
<a href="#ref_RunningFlags">
<b>CC, CXX, CPP, AR,RANLIB, STRIP, CFLAGS, CXXFLAGS, CPPFLAGS, LDFLAGS, LIBS</b></a>):

<br></br>
<a name="ref_TablePreset">
<table border=1 cellspacing=0>
  <caption>Localization variables</caption>
  <tr>
	 <th>Name</th>
	 <th>Default</th>
	 <th>Synopsis</th>
  </tr>

  <tr>
	 <td><b>CONFIG_SHELL</b></td>
	 <td><i>/bin/sh</i></td>
	 <td>Command interpreter to use in the configuration scripts and makefiles
	     (it must be compatible with "<b>sh</b>")</td>
  </tr>

  <tr>
	 <td><b>THREAD_LIBS</b></td>
	 <td><i>-lpthread</i></td>
	 <td>System thread library</td>
  </tr>

  <tr>
	 <td><b>NETWORK_LIBS</b></td>
	 <td><i>-lsocket -lnsl</i></td>
	 <td>System network library</td>
  </tr>

  <tr>
	 <td><b>FASTCGI_LIBS</b></td>
	 <td><i>-lfcgi</i></td>
	 <td>Library to create Fast-CGI scripts</td>
  </tr>

  <tr>
	 <td><b>NCBI_C_PATH</b></td>
	 <td><i>$NCBI</i></td>
	 <td>Path to the NCBI C toolkit</td>
  </tr>

  <tr>
	 <td><b>NCBI_C_INCLUDE</b></td>
	 <td><i>$NCBI_C_PATH/include</i></td>
	 <td>Path to the NCBI C toolkit header files</td>
  </tr>

  <tr>
	 <td><b>NCBI_C_RELEASE_LIB</b></td>
	 <td><i>$NCBI_C_PATH/lib</i></td>
	 <td>Path to the NCBI C toolkit release libraries</td>
  </tr>

  <tr>
	 <td><b>NCBI_C_DEBUG_LIB</b></td>
	 <td><i>$NCBI_C_PATH/altlib</i></td>
	 <td>Path to the NCBI C toolkit debug libraries</td>
  </tr>

  <tr>
	 <td><b>PM_PATH</b></td>
	 <td><i>No_PmPath</i></td>
	 <td>Path to the NCBI PubMed package</td>
  </tr>

  <tr>
	 <td><b>NCBI_SSS_PATH</b></td>
	 <td><i>No_NcbiSSSPath</i></td>
	 <td>Path to the NCBI SSS package</td>
  </tr>

  <tr>
	 <td><b>NCBI_SSS_INCLUDE</b></td>
	 <td><i>$NCBI_SSS_PATH</i></td>
	 <td>Path to the NCBI SSS header files</td>
  </tr>

  <tr>
	 <td><b>NCBI_SSS_RELEASE_LIB</b></td>
	 <td><i>$NCBI_SSS_PATH/Release</i></td>
	 <td>Path to the NCBI SSS release libraries</td>
  </tr>

  <tr>
	 <td><b>NCBI_SSS_DEBUG_LIB</b></td>
	 <td><i>$NCBI_SSS_PATH/Debug</i></td>
	 <td>Path to the NCBI SSS debug libraries</td>
  </tr>

  <tr>
	 <td><b>SYBASE_PATH</b></td>
	 <td><i>No_SybasePath</i></td>
	 <td>Path to Sybase package</td>
  </tr>
</table>

<p>
Yet, you may need to modify the relevant sub-script or even create a new one
to adopt for your local environment.

<p>
It is possible to use <b><i>configure</i></b> under Windows NT,
e.g. for the MSVC++ compiler -- if there is a "<i>sh</i>" or
<a href="http://www.lns.cornell.edu/public/COMP/info/bash/bashref_toc.html">
"<i>bash</i>"</a>
<a href="http://www.gci-net.com/~users/c/cteeple/windowsnttrueshells.htp">
emulators for MS Windows</a>. Sub-script <b><i>compilers/msvc_nt.env</i></b> does the
job.

<p>
And, if you have installed
<a href="http://sourceware.cygnus.com/cygwin/">CYGWIN</a>
enviroment and "egcs" GNU C/C++ compiler on your NT, then you can use
<b><i>compilers/egcs_nt.env</i></b> to configure your <i>build tree</i>.


<p>
<a name="ref_PreBuiltHeaders"></a>
However, most of NT users have neither <b><i>sh</b></i>-like interpreter nor
GNU <b><i>make</i></b> installed on their PCs. They can use pre-built
<b><i>ncbiconf.ms6</i></b> configuration header, and use a hierarchy of
<a href="#ref_MsvcProj">projects for the MS Visual C++ Studio</a>.

<p>
The same is for Mac users -- we have a (manually maintained) 
<b><i>compilers/ncbiconf.mac</i></b> configuration header.

<br></br>
<a name="ref_Example">
<h2>An example of configuration, installation and build</h2>
</a>

To configure, install and build all NCBI C++ projects on Sun with
SunPro 5.0 compilers using CVS repository and relevant sub-script
<b><i>compilers/ws50_sun.env</i></b>:

<pre>
# Retrieve NCBI C++ sources from the NCBI CVS tree(to "cpp_foo" directory)
cvs checkout -d cpp_foo internal/c++

# Configure
#  HINT:  run "configure.sh" without parameters to see the USAGE info
#  HINT:  run "configure.sh" with one meaningless argument(e.g. "eee")
#         to see all allowed values for the 1st argument
cd cpp_foo
sh ./configure.sh ws50_sun build_bar

# Perform a recursive build
cd build_bar
make all_r
</pre>


<br></br>
<a name="ref_Compilers"><h2>List of supported compilers</h2>
</a>

<p>
As for now, at least the following compilers give enough support
(as concerns to the C++ and STL implementation) to build NCBI C++
libraries and tools:
<ul>
  <li> SunOS (5.6 and higher)
    <ul>
      <li> <b>WorkShop</b> Compilers 5.0 on SUN sparc and PC i586
      <li> <b>egcs</b>-2.91.66 (using "-fsquangle" compiler flag)
		     on SUN sparc and PC i586
    </ul>

  <li> MS Windows (NT)
    <ul>
      <li> <b>MSVC++</b> 6.0 (SP3) on PC i586
		<li> <b>egcs</b>-2.91.57 for CYGWIN_NT-4.0 on PC i586
    </ul>

  <li> MacOS
    <ul>
      <li> Metrowerks <b>CodeWarrior</b> on PowerPC
    </ul>

  <li> Linux (RedHat 5.2)
    <ul>
      <li> <b>egcs</b>-2.91.66 on PC i586
    </ul>

  <li> IRIX64 (6.4)
    <ul>
      <li> <b>egcs</b>-2.91.66 (using "-fsquangle" compiler flag) on SGI mips
    </ul>

  <li> OSF1 (V4.0)
    <ul>
      <li> <b>egcs</b>-2.91.66 (using "-fsquangle" compiler flag) on DEC alpha
    </ul>
</ul>
NOTE: Some projects(e.g. "query") are very platform-specific, and they cannot
be adopted(or even compiled) for all supported platforms. All such projects
are located under the <i><b>internal/c++/{src|include}/internal/</b></i> directories.


<br></br>
<a name="ref_AdHoc"><h2>Ad-hoc installations</h2>
</a>

<p>
<a name="ref_MsvcProj"><h4>MS Visual C++ workspace</h4>
</a>

<p>
Suppose you have deployed the NCBI C++ tree on your local PC, in directory
<i><b>C:\foo</b></i> (you can do it by either performing the
<a href="win_cvs.html">CVS checkout</a>
of <i><b>internal/c++</b></i> or by expanding the distributed self-extracting
NCBI C++ source archive) and you want to use MSVC++ to work with these
sources.

<p>
In order to adjust the MSVC++ project files for your local
<i><b>C:\foo</b></i> you must do exactly the following:
<ol>
  <li> Go to directory <i><b>compilers/</b></i> and run script
		<i><b>msvc_nt.bat</b></i>
  <li> Launch MSVC++ Developer Studio, then:
	 <ul>
		<li> go to <i>"Tools"/"Options"</i> form
		<li> goto folder <i>"Directories"</i>
		<li> choose option <i>"Include files"</i> in the <i>"Show directories for:"</i> option menu
		<li> add "<i><b>C:\foo\include</b></i>" to the shown include directory list
		<li> if you want to use "internal" parts of the NCBI C++
		     toolkit(such as <b>xhc</b> library) then add
           "<i><b>C:\foo\include\internal</b></i>" to the shown include directory list
	 </ul>
</ol>

Now when the installation is complete you can load workspace
<i><b>compilers/msvc_prj/ncbi_cpp.dsw</b></i> and build all basic libraries and test
applications(project <b>core_all</b>) or just libraries(project <b>core_lib</b>),
or any single library and/or application(other projects in this
workspace).

<p>
There are also projects(such as <b>tool</b>, <b>xasn</b> and <b>xhist</b>)
that engage the
<a href="http://sunweb.ncbi.nlm.nih.gov:6224/IEB/ncbi_toolbox/README.htm">
NCBI C toolkit</a>.
To build these, you have to have the "old" NCBI C toolkit's libraries and
header files accessible from your PC, and you must specify path to them in
<i>"Tools"/"Options"</i> form, folder <i>"Directories"</i>,
options <i>"Include files"</i>(e.g. <i><b>C:\ncbi\include.32</b></i>),
<i>"Library files"</i> and <i>"Source files"</i> (e.g. <i><b>C:\ncbi\build_d.m32</b></i>).

<p>
For example, here in NCBI the paths to the automatically built C toolkit 
are as follows:
<ul>
  <li> <i>\\dizzy\users\coremake\public\<b>include</b></i>
  <li> <i>\\dizzy\users\coremake\public\<b>dbglib</b></i>
  <li> <i>\\dizzy\users\coremake\public\<b>altsrc</b></i>
</ul>

<br></br>
<hr>
<table border=0 width="100%" cellspacing=0>
<tr>
<td><address><a href="mailto:vakatov@ncbi.nlm.nih.gov">Denis Vakatov</a></address></td>
<td align=right>($Revision$)</td></tr>
</table>
</body>
</html>
