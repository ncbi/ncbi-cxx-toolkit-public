<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>Installation and configuration</title>
</head>

<body>
<h1>Installation and configuration</h1>


<ul>
  <li> <a href="#ref_Source">
       NCBI C++ source code repository</a> 
  <li> <a href="#ref_Configure">
       Configuration and installation script <b><i>configure</i></b></a>
  <li> <a href="#ref_Build">
		  Structure of the <i>build tree</i> produced by <b><i>configure</i></b></a>
  <li> <a href="#ref_Running">
       Running the <b><i>configure</i></b> script</a>
		 <ul>
		   <li> <a href="#ref_DebugVsRelease">
			<i>Debug</i> vs. <i>Release</i> configuration</a>
		   <li> <a href="#ref_DLL">
			Building shared libraries (DLLs)</a>
		   <li> <a href="#ref_NamingBuildTree">
			Naming the <i>build tree</i></a>
		   <li> <a href="#ref_AfterConf">
			After-configure user callback script</a>
		   <li> <a href="#ref_ToolsAndFlags">
			Tools and Flags</a>
         <li> <a href="#ref_Localization">
         Localization for the system and third-party packages</a>
         <li> <a href="#ref_ProhibitPackage">
         Prohibiting the use of some of the system and third-party packages</a>
         <li> <a href="#ref_Wrappers">
         Compiler-specific <b><i>configure</i></b> wrappers
         (<i>compilers/*.sh</i>) </a>
         <li> <a href="#ref_PreBuiltHeaders">
         Pre-built configuration headers
         (<i>compilers/ncbiconf.*</i>) </a>
		 </ul>
  <li> <a href="#ref_Reconf">
       Quick reconfiguration</a>
	 </a>
  <li> <a href="#ref_Example">
       An example of configuration, installation and build</a>
  <li> <a href="#ref_Compilers">
       List of supported compilers</a>
  <li> <a href="#ref_AdHoc">
       Ad-hoc installations</a>
	 <ul>
		<li> <a href="#ref_MsvcProj">
		  MS Visual C++</a>
	   <ul>
		  <li> <a href="#ref_MsvcProjTree">
		    Building the whole NCBI C++ tree locally</a>
		  <li> <a href="#ref_MsvcProjCXX">
		    Using pre-built NCBI C++ toolkit in your projects</a>
		  <li> <a href="#ref_MsvcProjC">
		    Using NCBI C toolkit</a>
		  <li> <a href="#ref_MsvcProjSettings">
		    Mandatory project settings (RTTI, MT-safety)</a>
	   </ul>
	 </ul>
</ul>

<p>
This page describes how to get the NCBI C++ sources, and how to
configure/deploy a build directory with the <i>ncbiconf.h</i> header and
all makefiles configured to work on the specified platform with
the specified compiler (and other tools) and flags.

<br></br>
<a name="ref_Source">
<h2>NCBI C++ source code repository</h2>
</a>

<p>
The NCBI C++ toolkit sources and data can be
<a href="new_proj.html#ref_Checkout">retrieved</a> from the internal NCBI
CVS tree -- either directly from <i><b>"$CVSROOT/internal/c++/"</b></i>, or using
auxiliary scripts <b><i>scripts/cvs_core.sh</i></b></a> and
<b><i>scripts/cvs_core_msvc.bat</i></b>.

The resultant <a href="src_tree.gif"><i>NCBI C++  source tree</i></a> will contain:
<ul>
  <li> set of files needed for the platform-specific
		 <a href="#ref_Running">configuration and installation</a>:
       <ul>
         <li>  <i><b>configure</b></i> -- a multi-platform configuration shell
               script (generated from template <i>configure.in</i> using
               <a href="http://sunland.gsfc.nasa.gov/info/autoconf/Top.html">
               autoconf</a>)
         <li>  various scripts and template files used by
               <i><b>configure</b></i>,
               <a href="http://sunland.gsfc.nasa.gov/info/autoconf/Top.html">
               autoconf</a> and
               <a href="http://sunland.gsfc.nasa.gov/info/autoconf/Invoking_autoheader.html"> autoheader</a>
         <li>  <i><b>compilers/</b></i> -- directory containing
               <a href="#ref_Wrappers">
               compiler-specific <b><i>configure</i></b> wrappers</a>
               (<i>*.sh</i>) and
               <a href="#ref_PreBuiltHeaders">
               pre-built configuration headers</a>
               (<i>ncbiconf.*</i>) for some platforms
       </ul>

  <li> <i><b>doc/</b></i> -- NCBI C++ documentation, manuals (including
       this one, <i>doc/config.html</i>) and guidelines
       for (hopefully) <b>everybody</b> writing on C++ in NCBI SWG

  <li> <i><b>scripts/</b></i> -- auxiliary scripts, such as
		  <a href="new_proj.html#ref_OutsideImport">
			 <b><i>import_project.sh</i></b></a>,
		  <a href="new_proj.html#ref_OutsideCreate">
			 <b><i>new_project.sh</i></b></a>,
		  <a href="new_proj.html#ref_Checkout">
			 <b><i>cvs_core.sh</i></b></a>,
        etc.

  <li> <i><b>src/</b></i> -- a hierarchical directory tree of
       <a href="new_proj.html">NCBI C++ projects</a>. Here go
       all source files (<i>*.cpp, *.c</i>), private header and inline files
       (<i>*.hpp, *.inl, *.h</i>), makefiles (<i>Makefile.*</i>, including
       <a href="new_proj.html#ref_MakeProjMk"><i>Makefile.mk</i></a>),
       scripts (<i>*.sh</i>), and maybe some project-specific data

  <li> <i><b>include/</b></i> -- a hierarchical directory tree whose
       structure mirrors the <i><b>src/</b></i> directory tree. It
       contains only public header and inline files (<i>*.hpp, *.inl, *.h</i>).
       <br><i>Example:</i> <i><b>include/corelib/</b></i> contains public headers for the sources
       located in <i><b>src/corelib/</b></i>
</ul>


<a name="ref_Configure">
<h2>Configuration and installation script <b><i>configure</i></b></h2>
</a>

<p>
Different compilers compile C++ (and even C!) code differently --
they may vary in the OS standard libraries and header files,
completeness of the C++ implementation, and... in compiler bugs.
There are also different <b>make</b> and other tools and
file naming conventions on different platforms.

<p>
Thus, a configuration is needed to encounter the platform-
and compiler-specific features.
For this purporse, we are using the GNU
<a href="http://sunland.gsfc.nasa.gov/info/autoconf/Top.html">autoconf</a> 
utility to automatically generate compiler-specific header file
<i>ncbiconf.h</i> and makefiles that would work for the given platform.

<p>
User performs both configuration and installation by merely running
platform-independent(<i>sh, bash</i>) shell script
<b><i>configure</i></b> (we pre-generate it in-house from template
<i>configure.in</i> using
<a href="http://sunland.gsfc.nasa.gov/info/autoconf/Top.html">
autoconf</a>).

<p>
During the configuration process, many compiler features are tested,
and the results of this testing are recorded in the configuration header
<i>ncbiconf.h</i> by the means of C preprocessor variables. E.g., the
preprocessor variable <i>"NO_INCLASS_TMPL"</i> indicates whether the
compiler supports template class methods; another example of the information 
contained in <i>ncbiconf.h</i> are preprocessor variables used to
define <a href="types.html#ref_IntFixed">sized integer</a> and
<a href="types.html#ref_BigScalar"><i>BigScalar</i></a> types.

<p>
The <b><i>configure</i></b> script will create so-called
<a href="bld_tree.gif"><i>build tree</i></a>
-- a hierarchy of directories where
object modules, libraries and executables are to be built.
<br>
It will also configure all <i>*.in</i> template files located
in the NCBI C++  source tree(<b><i>src/</i></b>) and deploy
the resultant configured files in the relevant places of the
<a href="bld_tree.gif"><i>build tree</i></a>.

This way, all platform- and compiler-specific tools and flags will be "frozen"
inside the configured makefiles in the
<a href="bld_tree.gif"><i>build tree</i></a>.
And, the <i>ncbiconf.h</i> (described above, also configured for
the given compiler), will be put to the <b><i>inc/</i></b> sub-directory
of the resultant
<a href="bld_tree.gif"><i>build tree</i></a>.

<p>
User can create as many such build trees as he needs.  All these
trees would refer to just the same (origin) NCBI C++ 
<a href="src_tree.gif"><i>source tree</i></a> and <i>include tree</i>,
while each
<a href="bld_tree.gif"><i>build tree</i></a>
can contain its own (platform/compilator-specific)
<i>ncbiconf.h</i> header, and/or different set of compilation/linking/etc.
flags and tools ("frozen" in the makefiles, especially in
<a href="new_proj.html#ref_MakeProjMk"><i>Makefile.mk</i></a>).
This is to allow one to build
libraries and executables using different compilers and/or flags, yet from
the same sources, and in a uniform way.


<br></br>
<a name="ref_Build">
<h2>Structure of the <i>build tree</i> produced by <b><i>configure</i></b></h2>
</a>

<p>
Each configuration process results in a new <i>build tree</i>.
The structure of the tree is as follows (see also in
<a href="bld_tree.gif">chart</a>):
<ul>
  <li> <i><b>inc/</b></i> -- contains
       <i>ncbiconf.h</i> configuration header generated by the
       <b><i>configure</i></b> script.
  <li> <i><b>build/</b></i> -- contains a hierarchy of directories that
       correspond to those in the <i><b>src/</b></i> (in NCBI C++ original
       sources). These directories will contain makefiles (<i>Makefile.*</i>)
       generated by the <b><i>configure</i></b> script from the makefile
       templates (<i>Makefile.*.in</i>) of corresponding project located in the
		 <i>source tree</i>.
       <br>
       The resultant scripts and makefile will keep referencies
       to the original NCBI C++ source directories.
       <br>
       There is a "very special" file
       <a href="new_proj.html#ref_MakeProjMk"><i>Makefile.mk</i></a>
       that contains all configured
       <a href="#ref_ToolsAndFlags">tools, flags</a>
       and
       <a href="#ref_Localization">local paths</a>.
       This file is usually included by other makefiles.
       <br>
       Later, all build results (object modules, libraries and executables
       as well as any auxiliary files and directories created during the build)
       will go exclusively into the <i>build tree</i>, and not
       to the original NCBI C++ source directories. This allows one to
       have several <i>build trees</i> that use just the same sources, but
       compile and link them with different flags and/or compilers.
  <li> <i><b>lib/</b></i> -- here go all public libraries built by the
       <i><b>build/</b></i>-located projects.
  <li> <i><b>bin/</b></i> -- here go all public executables built by the
       <i><b>build/</b></i>-located projects.
  <li> <i><b>status/</b></i> -- contains cache (<i>config.cache</i>),
       log file (<i>config.log</i>), and secondary configuration script
       (<i>config.status</i>) produced by <b><i>configure</i></b> during
       the configuration process.
</ul>


<a name="ref_Running">
<h2>Running the <b><i>configure</i></b> script</h2>
</a>


<p>
<a name="ref_DebugVsRelease"></a>
<h4><i>Debug</i> vs. <i>Release</i> configuration</h4>

The following two <i><b>configure</b></i> flags control whether to target for
the <i>Debug</i> or <i>Release</i> version. These options (default is
<i><b>--with-debug</b></i>) control the appearance of preprocessor
flags <b>-D_DEBUG</b> and <b>-DNDEBUG</b>, and compiler/linker flags
<b>-g</b> and <b>-O</b>, respectively:
<ul>
  <li> <i><b>--with-debug</b></i> --
       engage <b>-D_DEBUG</b> and <b>-g</b>,
       <br>strip <b>-DNDEBUG</b> and <b>-O</b>
       (if not <i><b>--with-release</b></i>)
  <li> <i><b>--without-debug</b></i> --
       strip <b>-D_DEBUG</b> and <b>-g</b>,
       <br>engage <b>-DNDEBUG</b> and <b>-O</b>
		 (if not <i><b>--without-release</b></i>)
  <li> <i><b>--with-release</b></i> --
       engage <b>-DNDEBUG</b> and <b>-O</b>
  <li> <i><b>--without-release</b></i> --
       strip <b>-DNDEBUG</b> and <b>-O</b>
</ul>


<p>
<br>
<a name="ref_DLL"></a>
<h4>Building shared libraries (DLLs)</h4>

On the capable platforms, you can build libraries as <i>shared (dynamic)</i>.
<ul>
  <li> <i><b>--with-dll</b></i> --
       compile position-independent code (PIC),
       build <i>dynamic</i> libraries.
  <li> <i><b>--without-dll</b></i> --
       do not compile PIC,
       build <i>static</i> libraries.
  <li> by default --
       compile position-independent code (PIC),
       build <i>static</i> libraries.
</ul>
HINT:  To build both <i>dynamic</i> and <i>static</i> libraries without
recompiling all sources:
<ol>
  <li> configure the toolkit without any of "<i><b>--.....-dll</b></i>" flags
  <li> build the toolkit
  <li> re-configure the toolkit with "<i><b>--with-dll</b></i>"
  <li> build the toolkit again
</ol>
We've succeeded in building NCBI C++ libs as DLLs on at least
the following platforms:
<ul>
  <li> <a href="http://egcs.cygnus.com/">
       <b>GCC 2.95.[1,2]</b></a>
    <ul>
      <li> Linux RedHat 5.2 --- <i>PC-Intel</i>
      <li> IRIX64 6.5 --- <i>SGI-Mips</i>
      <li> Solaris 2.6, 2.7 --- <i>SUN-Sparc</i> and <i>PC-Intel</i>
           (requires <i><b>libstd++.so</b></i>!)
    </ul>

  <li> <a href="http://www.sun.com/workshop/visual/">
       <b>Sun WorkShop 5.0</b></a>
    <ul>
      <li> 32-bit: Solaris 2.6, 2.7 --- <i>SUN-Sparc</i> and <i>PC-Intel</i>
      <li> 64-bit: Solaris 2.7 --- <i>SUN-Sparc</i>
    </ul>

  <li> <u><b>MIPSpro-7.30 (-n32)</b></u>
    <ul>
      <li> IRIX64 6.5 --- <i>SGI-Mips</i>
    </ul>
</ul>



<p>
<br>
<a name="ref_NamingBuildTree"></a>
<h4>Naming the <i>build tree</i></h4>

The configuration process will produce the new <i>build tree</i>
in some default subdirectory of the root source directory, and the base name
of this subdirectory will reflect the compiler name and a <i>Release/Debug</i>
suffix, e.g.:  <i><b>GCC-Release/</b></i>. The default <i>build tree</i>
name can be alternated by passing the following flags to the
<i><b>configure</b></i> script:
<ul>
  <li> <i><b>--without-debug-sfx</b></i> --
       do not add <i>Release/Debug</i> suffix to the <i>build tree</i> name
       <br><i>Example:</i> <i><b>GCC/</b></i>
  <li> <i><b>--with-hostspec</b></i> --
       add full host specs to the <i>build tree</i> name
       <br><i>Example:</i> <i><b>GCC-Debug--i586-pc-linux-gnu/</b></i>
  <li> <i><b>--exec-prefix=</b>/home/foo/bar</i> --
       specify your own <i>build tree</i> path and name
</ul>

With <i><b>--exec-prefix=</b></i>, you still can explicitly use
<i><b>--with-debug-sfx</b></i> and <i><b>--with-hostspec</b></i>
to add suffix(es) to your <i>build tree</i> name in a manner described above.
<br><i>Example:</i>
<i><b>--exec-prefix=</b>/home/foo/bar</i>
<i><b>--without-debug</b></i>
<i><b>--with-debug-sfx</b></i>
would deploy the new <i>build tree</i> in
<i><b>/home/foo/bar-Release</b></i>.

<p>
There is also a special case with <i><b>--exec_prefix=</b>.</i>
-- for those who prefer to put object files, libraries and executables to where
the sources are located. But be advised that this will disallow you
to configure for other <i>build trees</i>.

<p>
<br>
<a name="ref_AfterConf"></a>
<h4>After-configure user callback script</h4>

You can specify your own script to call from the <i>configure</i>
script after the configuration is complete:
<ul>
  <li> <i><b>--with-extra-action=</b>"&lt;some_action&gt;"</i>
</ul>
where <i>&lt;some_action&gt;</i> can be some script with parameters.
The trick here is that in the &lt;some_action&gt; string, all
occurences of "<i>{}</i>" will be replaced by the build dir name.
<br><i>Example:</i>
<br>&nbsp;&nbsp;&nbsp;<i>configure <b>--with-extra-action=</b>"echo foobar {}"</i>
<br>will execute (after the configuration is done):
<br>&nbsp;&nbsp;&nbsp;<i>echo foobar /home/user/c++/GCC-Debug</i>.


<p>
<br>
<a name="ref_ToolsAndFlags"></a>
<h4>Tools and flags</i></h4>

There is a predefined set of tools and flags used in the build process.
User can alternate these tools and flags by setting the following
environment variables for the <b><i>configure</i></b> script.

<br></br>
<a name="ref_TableToolsAndFlags">
<table border=1 cellspacing=0>
  <tr>
	 <th>Name</th>
	 <th>Default</th>
	 <th>Synopsis</th>
  </tr>

  <tr>
	 <td><b>CC</b></td>
	 <td><i>gcc, cc</i></td>
	 <td>C compiler</td>
  </tr>

  <tr>
	 <td><b>CXX</b></td>
	 <td><i>c++, g++, gcc, CC, cxx, cc++</i></td>
	 <td>C++ compiler, also being used as a linker</td>
  </tr>

  <tr>
	 <td><b>CPP</b></td>
	 <td><i>$CC -E</i></td>
	 <td>C preprocessor</td>
  </tr>

  <tr>
	 <td><b>CXXCPP</b></td>
	 <td><i>$CXX -E</i></td>
	 <td>C++ preprocessor</td>
  </tr>

  <tr>
	 <td><b>AR</b></td>
	 <td><i>ar cru</i></td>
	 <td>Librarian</td>
  </tr>

  <tr>
	 <td><b>STRIP</b></td>
	 <td><i>strip</i></td>
	 <td>To discard symbolic info</td>
  </tr>

  <tr>
	 <td><b>CFLAGS</b></td>
	 <td><i>-g</i>
    <a href="#ref_DebugVsRelease">or/and/nor</a>
	 <i>-O</i></td>
	 <td>C compiler flags</td>
  </tr>

  <tr>
	 <td><b>CXXFLAGS</b></td>
	 <td><i>-g</i>
    <a href="#ref_DebugVsRelease">or/and/nor</a>
	 <i>-O</i></td>
	 <td>C++ compiler flags</td>
  </tr>

  <tr>
	 <td><b>CPPFLAGS</b></td>
	 <td><i>-D_DEBUG</i>
    <a href="#ref_DebugVsRelease">or/and/nor</a>
    <i>-DNDEBUG</i></td>
	 <td>C/C++ preprocessor flags</td>
  </tr>

  <tr>
	 <td><b>LDFLAGS</b></td>
	 <td>none</td>
	 <td>Linker flags</td>
  </tr>

  <tr>
	 <td><b>LIBS</b></td>
	 <td>none</td>
	 <td>Libraries to link to every executable</td>
  </tr>

  <tr>
	 <td><b>CONFIG_SHELL</b></td>
	 <td><i>/bin/sh</i></td>
	 <td>Command interpreter to use in the configuration scripts and makefiles
	     (it must be compatible with <b>sh</b>)</td>
  </tr>
</table>

<p>
<a href="new_proj.html#ref_MakeProjMk">Later</a>, these tools and flags will
be engaged in the makefiles:
<a name="ref_StdBuildRules"></a>
<ul>
  <li> To compile C sources:
    <br> <b><i>$(CC) -c $(CFLAGS) $(CPPFLAGS) .....</i></b>
  <li> To compile C++ sources:
    <br> <b><i>$(CXX) -c $(CXXFLAGS) $(CPPFLAGS) .....</i></b>
  <li> To compose a library:
    <br> <b><i> $(AR)     </i></b> <i>libXXX.a xxx1.o xxx2.o xxx3.o .....</i> 
	 <br> <b><i> $(RANLIB) </i></b> <i>libXXX.a</i>
</i></b>
  <li> To link an executable:
    <br> <b><i>$(LINK) $(LDFLAGS) ..... $(LIBS)</i></b>
</ul>

For more info on these and other variables see in the
<a href="http://sunland.gsfc.nasa.gov/info/autoconf/Preset_Output_Variables.html">autoconf documentation</a>.
The specified tools and flags will then be "frozen" inside the makefiles of
<i>build tree</i> produced by this <b><i>configure</i></b> run.


<p>
<br>
<a name="ref_Localization"></a>
<h4>Localization for the system and third-party packages</h4>

<p>
There is some configuration info that usually cannot be guessed or detected
automatically, and thus in most cases it must be specified "manually" for
the given local host's working environment.

The following localization environment variables can be set in addition
to the "generic" ones
<a href="#ref_ToolsAndFlags">
<b>(CC, CXX, CPP, AR,RANLIB, STRIP, CFLAGS, CXXFLAGS, CPPFLAGS, LDFLAGS, LIBS)
</b></a>:

<br></br>
<a name="ref_TableLocalization">
<table border=1 cellspacing=0>
  <caption>User-defined localization variables</caption>
  <tr>
	 <th>Name</th>
	 <th>Default</th>
	 <th>Synopsis</th>
  </tr>

  <tr>
	 <td><b>THREAD_LIBS</b></td>
	 <td><i>-lpthread</i></td>
	 <td>System thread library</td>
  </tr>

  <tr>
	 <td><b>NETWORK_LIBS</b></td>
	 <td><i>-lsocket -lnsl</i></td>
	 <td>System network libraries</td>
  </tr>

  <tr>
	 <td><b>SYBASE_PATH</b></td>
	 <td><i>/netopt/Sybase/clients/current</i></td>
	 <td>Path to Sybase package</td>
  </tr>

  <tr>
	 <td><b>FASTCGI_PATH<br></b></td>
	 <td><i>$NCBI</i></td>
	 <td>Path to the in-house Fast-CGI client lib</td>
  </tr>

  <tr>
	 <td><b>NCBI_C_PATH</b></td>
	 <td><i>$NCBI</i></td>
	 <td>Path to the NCBI C toolkit</td>
  </tr>

  <tr>
	 <td><b>NCBI_SSS_PATH</b></td>
	 <td><i>/net/neptune/pubmed1/sss</i></td>
	 <td>Path to the NCBI SSS package</td>
  </tr>

  <tr>
	 <td><b>NCBI_PM_PATH</b></td>
	 <td><i>/net/neptune/pubmed1/Cvs5</i></td>
	 <td>Path to the NCBI PubMed package</td>
  </tr>
</table>


<p>
Based on the above, <b><i>configure</i></b> will derive the following variables
to use in the generated makefiles: 

<br></br>
<a name="ref_TableLocalization1">
<table border=1 cellspacing=0>
  <caption>Derived localization variables for makefiles</caption>
  <tr>
	 <th>Name</th>
	 <th>Value</th>
	 <th>Used to...</th>
  </tr>

  <tr>
	 <td><i><b>THREAD_LIBS</b></i></td>
	 <td>$THREAD_LIBS</td>
	 <td>link with system thread lib</td>
  </tr>

  <tr>
	 <td><i><b>NETWORK_LIBS</b></i></td>
	 <td>$NETWORK_LIBS</td>
	 <td>link with system network libs</td>
  </tr>

  <tr>
	 <td><i><b>SYBASE_INCLUDE</b></i></td>
	 <td><i><b>-I</b></i>$SYBASE_PATH<i>/include</i></td>
	 <td><i>#include</i> Sybase headers</td>
  </tr>

  <tr>
	 <td><i><b>SYBASE_LIBS</b></i></td>
	 <td><i><b>-L</b></i>$SYBASE_PATH<i>/lib <br>
       <b>-l</b>ct <b>-l</b>cs <b>-l</b>tcl <b>-l</b>comn <b>-l</b>intl
    </i></td>
	 <td>link with Sybase libs</td>
  </tr>

  <tr>
	 <td><i><b>FASTCGI_INCLUDE</b></i></td>
	 <td><i><b>-I</b></i>$FASTCGI_PATH<i>/include</i></td>
	 <td><i>#include</i> Fast-CGI headers</td>
  </tr>

  <tr>
	 <td><i><b>FASTCGI_LIBS</b></i></td>
	 <td><i><b>-L</b></i>$FASTCGI_PATH<i>/lib <b>-l</b>fcgi</i>
        <br> or <br>
        <i><b>-L</b></i>$FASTCGI_PATH<i>/altlib <b>-l</b>fcgi</i> </td>
	 <td>link with Fast-CGI lib</td>
  </tr>

  <tr>
	 <td><i><b>NCBI_C_INCLUDE</b></i></td>
	 <td><i><b>-I</b></i>$NCBI_C_PATH<i>/include</i></td>
	 <td><i>#include</i> NCBI C toolkit headers</td>
  </tr>

  <tr>
	 <td><i><b>NCBI_C_LIBPATH</b></i></td>
	 <td><i><b>-L</b></i>$NCBI_C_PATH<i>/lib</i>
        <br> or <br>
        <i><b>-L</b></i>$NCBI_C_PATH<i>/altlib</i></td>
	 <td>path to NCBI C toolkit libs</td>
  </tr>

  <tr>
	 <td><i><b>NCBI_C_ncbi</b></i></td>
	 <td><i><b>-l</b>ncbi</i></td>
	 <td>link with NCBI C CoreLib</td>
  </tr>

  <tr>
	 <td><i><b>NCBI_SSSDB_INCLUDE</b></i></td>
	 <td><i><b>-I</b></i>$NCBI_SSS_PATH/db</td>
	 <td><i>#include</i> NCBI SSS DB headers</td>
  </tr>

  <tr>
	 <td><i><b>NCBI_SSSDB_LIBS</b></i></td>
	 <td><i><b>-L</b></i>$NCBI_SSS_PATH<i>/db/Release -<b>l</b>sssdb</i> <br>or<br>
        <i><b>-L</b></i>$NCBI_SSS_PATH<i>/db/Debug -<b>l</b>sssdb</i>
    </td>
	 <td>link with NCBI SSS DB libs</td>
  </tr>

  <tr>
	 <td><i><b>NCBI_SSSUTILS_INCLUDE</b></i></td>
	 <td><i><b>-I</b></i>$NCBI_SSS_PATH/utils</td>
	 <td><i>#include</i> NCBI SSS UTILS headers</td>
  </tr>

  <tr>
	 <td><i><b>NCBI_SSSUTILS_LIBS</b></i></td>
	 <td><i><b>-L</b></i>$NCBI_SSS_PATH<i>/utils/Release -<b>l</b>sssutils</i> <br>or<br>
        <i><b>-L</b></i>$NCBI_SSS_PATH<i>/utils/Debug -<b>l</b>sssutils</i>
    </td>
	 <td>link with NCBI SSS UTILS libs</td>
  </tr>

  <tr>
	 <td><i><b>NCBI_PM_PATH</b></i></td>
	 <td>$NCBI_PM_PATH</td>
	 <td>path to the PubMed package</td>
  </tr>
</table>

<p>
<br>
<a name="ref_ProhibitPackage"></a>
<h4>Prohibiting the use of some of the system and third-party packages</h4>

<p>
Some of the above system and third-party packages can
be prohibited to use -- using the following <b><i>configure</i></b>
flags:

<ul>
  <li> <i><b>--without-sybase</b></i> (Sybase)
  <li> <i><b>--without-fastcgi</b></i> (Fast-CGI)
  <li> <i><b>--without-ncbi-c</b></i> (NCBI C toolkit)
  <li> <i><b>--without-sssdb</b></i> (NCBI SSS DB)
  <li> <i><b>--without-sssutils</b></i> (NCBI SSS UTILS)
  <li> <i><b>--without-sss</b></i>
		  (both <i><b>--without-sssdb</b></i> and <i><b>--without-sssutils</b></i>)
  <li> <i><b>--without-pubmed</b></i> (NCBI PubMed)
</ul>

Also, the build of all internal projects
(located under the <i><b>internal/c++/{src|include}/internal/</b></i> directories)
is disabled by default on almost all platforms. To enable it, one
must pass flag <b><i>--with-internal</i></b> to the <b><i>configure</i></b>
script.


<p>
<br>
<a name="ref_Wrappers"></a>
<h4>Compiler-specific <b><i>configure</i></b> wrappers</h4>

<p>
Most of the non-GCC compilers require special tools and additional
mandatory flags to compile and link C++ code properly. That's why we
have to have special scripts that perform the required non-standard
compiler-specific pre-initialization for the used
<a href="#ref_ToolsAndFlags">tools and flags</a> before running
<b><i>configure</i></b>.
<br>
These wrapper scripts are located in the <i><b>compilers/</b></i>
directory, and now we have such wrappers for WorkShop 5.0, MIPSpro 7.30,
GCC/Cygwin-NT, and MSVC++ compilers:
  <ul>
    <li> <i><b>WorkShop5.sh</b></i> {32|64} [build_dir] [--configure-flags]
    <li> <i><b>MIPSpro73.sh</b></i> [--configure-flags]
    <li> <i><b>gcc_nt.bash</b></i> [--configure-flags]
    <li> <i><b>msvc_nt.bash</b></i> [--configure-flags]
  </ul>
Note, that these scripts accept all regular <b><i>configure</i></b> flags
and then pass them to the <b><i>configure</i></b> script.


<p>
<br>
<a name="ref_PreBuiltHeaders"></a>
<h4>Pre-built configuration headers</h4>

<p>
Although it is possible to run <b><i>configure</i></b> under Windows NT,
(as we do for the MSVC++ compiler), however it requires having a
<i>sh</i>-compatible command interpreter installed on your PC.
In-house, we run <i><b>msvc_nt.bash</b></i> using 
<a href="http://www.lns.cornell.edu/public/COMP/info/bash/bashref_toc.html">
<i>bash</i></a> in the
<a href="http://sourceware.cygnus.com/cygwin/">CYGWIN</a>
environment.

<p>
As soon as most of NT users do not usually "play" with the extensions
like <i>bash/CYGWIN</i> on their PCs but just want to use MSVC++
Development Studio, so there is a pre-build configuration header
for MSVC++ 6.0:
<i><b>compilers/ncbiconf.ms6</b></i>.

MSVC++ users can use this header and a ready-to-use hierarchy of
<a href="#ref_MsvcProj">projects for the MS Visual C++ Studio</a>.

<p>
The same is for Mac Metrowerks CodeWarrior on PowerPC --
we have a manually maintained <i><b>compilers/ncbiconf.mac</b></i>
(however we dont have a ready-to-use Mac-specific project tree).


<p>
<br>
<a name="ref_Reconf">
<h2>Quick reconfiguration</h2>
</a>

<p>
Sometimes, after you have done some changes in your existing <i>*.in</i>
files (e.g. makefiles) in the <i>source tree</i>, you may want to reconfigure
one of your <i>build trees</i> to pick up your fixes. To do this, just
just run script <i><b>status/config.status</i></b> located in
the relevant <i>build tree</i>.
<br>
This technique also helps if some <i>*.in</i> files have been modified
in the result of CVS update in your <i>source tree</i>.

<p>
If you <b>added</b> or <b>removed</b> any of <i>*.in</i> files then you must
reconfigure your <i>build tree</i> all anew by calling the configuration script
again, just like you did for the original configuration.


<p>
<br>
<a name="ref_Example">
<h2>An example of configuration, installation and build</h2>
</a>

To retrieve, configure, install and build all available NCBI C++ projects:

<pre>
# Retrieve NCBI C++ sources from the NCBI CVS tree(e.g. to "cpp_foo/" dir)
cvs checkout -d ~/cpp_foo internal/c++


# Configure for WorkShop 5.0 compilers, then build recursively
cd ~/cpp_foo
compilers/WorkShop5.sh 32 my_build_dir

cd my_build_dir
make all_r


# Configure for GCC compiler, then build recursively
cd ~/cpp_foo
./configure

cd GCC-Debug
make all_r
</pre>


<br>
<a name="ref_Compilers"><h2>List of supported compilers</h2>
</a>

<p>
As for now, at least the following compilers give enough support
(as concerns to the C++ and STL implementation) to build NCBI C++
libraries and tools:
<ul>
  <li> <a href="http://egcs.cygnus.com/">
       <b>GCC 2.95.[1,2]</b></a>
    <ul>
      <li> Solaris 2.7 --- <i>SUN-Sparc</i> and <i>PC-Intel</i>
      <li> Linux RedHat 5.2 --- <i>PC-Intel</i>
      <li> OSF1 4.0 --- <i>DEC-Alpha</i>
      <li> IRIX64 6.5 --- <i>SGI-Mips</i>
    </ul>

  <li> <a href="ftp://ftp.xraylith.wisc.edu/pub/khan/gnu-win32/cygwin/gcc-2.95/">
       <b>GCC 2.95</b></a>
    <ul>
      Windows NT 4.0
      (with <a href="http://sourceware.cygnus.com/cygwin/">CYGWIN</a> Beta 20.1) --- <i>PC-Intel</i>
    </ul>

  <li> <a href="http://www.sun.com/workshop/visual/">
       <b>Sun WorkShop 5.0</b></a>
    <ul>
      <li> 32-bit: Solaris 2.6, 2.7 --- <i>SUN-Sparc</i> and <i>PC-Intel</i>
      <li> 64-bit: Solaris 2.7 --- <i>SUN-Sparc</i>
    </ul>

  <li> <u><b>MSVC++ 6.0 (SP3)</b></u>
    <ul>
      <li> Windows NT 4.0  --- <i>PC-Intel</i>
    </ul>

  <li> <u><b>MIPSpro-7.30 (-n32)</b></u>
    <ul>
      <li> IRIX64 6.5 --- <i>SGI-Mips</i>
    </ul>

  <li> <u><b>Metrowerks CodeWarrior</b></u>
    <ul>
      <li> MacOS -- <i>PowerPC</i>  (very poor support)
    </ul>
</ul>
NOTE: Some projects are very platform-specific, and they cannot
be built for all of the supported platforms.
All such projects are located under the <i><b>internal/c++/{src|include}/internal/</b></i>
directories.


<p>
<br>
<a name="ref_AdHoc"><h2>Ad-hoc installations</h2>
</a>

<p>
<a name="ref_MsvcProj"><h3>MS Visual C++</h3>
</a>

<p>
<a name="ref_MsvcProjTree"><h4>Building the whole NCBI C++ tree locally</h4>
</a>

<p>
Suppose you have deployed the NCBI C++ tree on your local PC, in directory
<i><b>C:\foo</b></i> (you can do it by either performing the
<a href="win_cvs.html">CVS checkout</a>
of <i><b>internal/c++</b></i> or by expanding the distributed self-extracting
NCBI C++ source archive), and you want to use MSVC++ to work with these
sources.

<p>
In order to adjust the MSVC++ project files for your local
<i><b>C:\foo</b></i> you must do exactly the following:
<ol>
  <li> Go to directory <i><b>compilers/</b></i> and run script
		<i><b>msvc_nt.bat</b></i>
  <li> Launch MSVC++ Developer Studio, then:
	 <ul>
		<li> go to <i>"Tools"/"Options"</i> form
		<li> goto folder <i>"Directories"</i>
		<li> choose option <i>"Include files"</i> in the <i>"Show directories for:"</i> option menu
		<li> add "<i><b>C:\foo\include</b></i>" to the shown include directory list
		<li> if you want to use "internal" parts of the NCBI C++
		     toolkit(such as <b>xhc</b> library) then add
           "<i><b>C:\foo\include\internal</b></i>" to the shown include directory list
	 </ul>
</ol>

Now when the installation is complete you can load workspace
<i><b>compilers/msvc_prj/ncbi_cpp.dsw</b></i> and build the following projects:
<ul>
  <li> <b>all</b> -- everything
  <li> <b>core_all</b> -- all basic libraries and test applications
  <li> <b>core_lib</b> -- all basic libraries
  <li> any single library and/or application -- other projects in this
       workspace
</ul>

<p>
As for now, you can build <i>any</i> project in <b>Debug</b> mode,
while <b>Release</b> versions are guranteed to build for <b>core_all</b>
projects only.
To switch from <b>Debug</b> to <b>Release</b> configuration use
<i>"Build"/"Set active configuration"</i>.


<p>
<a name="ref_MsvcProjCXX"><h4>Using pre-built NCBI C++ toolkit in your projects</h4>
</a>

<p>
For those who does not want to build the whole NCBI C++ tree, but just
need to use the NCBI C++ toolkit functionality in his own, separate project,
there are pre-built libraries and executables, along with the header and
source files located at:
<ul>
  <li> <i>\\dizzy\users\coremake\public\cxx\<b>include</b></i>
  <li> <i>\\dizzy\users\coremake\public\cxx\<b>dbglib</b></i>
  <li> <i>\\dizzy\users\coremake\public\cxx\<b>lib</b></i>
  <li> <i>\\dizzy\users\coremake\public\cxx\<b>altsrc</b></i>
  <li> <i>\\dizzy\users\coremake\public\cxx\<b>bin</b></i>
</ul>

You must specify path to them in <i>"Tools"/"Options"</i> form,
folder <i>"Directories"</i>.

<p>
If you just want to use the libs and the headers, and dont need to be
able to trace through their code during the debugging then
you only need to add paths <i>\\dizzy\users\coremake\public\cxx\<b>include</b></i>
and <i>\\dizzy\users\coremake\public\cxx\<b>lib</b></i> to
<i>"Include files"</i> and <i>"Library files"</i> directory lists, respectively.

<p>
But if you want to be able to debug in the NCBI C++ libraries,
then you will have to add <i>\\dizzy\users\coremake\public\cxx\<b>include</b></i>,
<i>\\dizzy\users\coremake\public\cxx\<b>dbglib</b></i>, and
<i>\\dizzy\users\coremake\public\cxx\<b>altsrc</b></i> to the
<i>"Include files"</i>, <i>"Library files"</i>, and <i>"Source files"</i> directory lists,
respectively.

<p>
In either case, dont forget to provide the right
<a href="#ref_MsvcProjSettings">settings</a> for your project
to make sure that it is built compatible with the chosen NCBI C++
libraries.



<p>
<a name="ref_MsvcProjC"><h4>Using NCBI C toolkit</h4>
</a>

<p>
There are projects(such as <b>tool</b>, <b>xasn</b> and <b>xhist</b>)
that engage the
<a href="http://sunweb.ncbi.nlm.nih.gov:6224/IEB/ncbi_toolbox/README.htm">
NCBI C toolkit</a>.
To build these, you have to have the "old" NCBI C toolkit's libraries and
header files accessible from your PC, and you must specify path to them in
<i>"Tools"/"Options"</i> form, folder <i>"Directories"</i>,
options <i>"Include files"</i>(e.g. <i><b>C:\ncbi\include.32</b></i>),
<i>"Library files"</i> and <i>"Source files"</i> (e.g. <i><b>C:\ncbi\build_d.m32</b></i>).

<p>
For example, here in NCBI the paths to the automatically built C toolkit 
are as follows:
<ul>
  <li> <i>\\dizzy\users\coremake\public\<b>include</b></i>
  <li> <i>\\dizzy\users\coremake\public\<b>dbglib</b></i>
  <li> <i>\\dizzy\users\coremake\public\<b>lib</b></i>
  <li> <i>\\dizzy\users\coremake\public\<b>altsrc</b></i>
</ul>


<p>
<a name="ref_MsvcProjSettings"><h4>Mandatory project settings (RTTI, MT-safety)</h4>
</a>

<p>
All projects are built in <b><i>MT-safe</i></b> mode
(i.e. with <b>/MT</b> flag), so you have to make sure that your
projects are using this flag as well.
In addition, many C++ projects use <i>Run-Time Type Info</i>.
<br>
To meet these requirements, you must do the following in
<i>"Project"/"Settings..."</i> form, folder <i>"C/C++"</i>:
<ul>
  <li> Category <i>"C++ Language"</i>: Enable RTTI
  <li> Category <i>"Code generation"</i>:  Use run-time library:
    <ul>
      <li> <i>"Multithreaded"</i> for the <b>Release</b> configuration
      <li> <i>"Debug Multithreaded"</i> for the <b>Debug</b> configuration
    </ul>
</ul>


<br></br>
<hr>
<table border=0 width="100%" cellspacing=0>
<tr>
<td align=left>
  <address><a href="mailto:vakatov@ncbi.nlm.nih.gov">Denis Vakatov</a></address>
</td>
<!-- <td align=center><i>$Revision$</i></td> -->
<td align=right><i>$Date$</i></td>
</tr>
</table>
</body>
</html>
