<!--#set var="TITLE" value="cgi.cpp" -->
<!--#set var="DOCROOT" value=".." -->
<!--#include virtual="../ssi/header.shtml" -->

  <pre><font color = "red">// File name: justcgi.cpp
// Description: Demonstrate the basic CGI classes and functions
<font color = "green">
#include "<a href="cgi_hpp.html">justcgi.hpp</a>"
#include &lt;cgi/cgictx.hpp>
#include &lt;corelib/ncbistd.hpp>
#include &lt;corelib/ncbireg.hpp>
#include &lt;memory>
</font>
<font color = "blue">
USING_NCBI_SCOPE;
</font>
/////////////////////////////////////////////////////////////////////////
// Implement the application's LoadResource() and ProcessRequest() methods
</font>
<font color = "black">
CNcbiResource* CCgiApp::LoadResource(void)
{ 
    auto_ptr&lt;CCgiResource> resource(new CCgiResource(GetConfig()));  
    resource->AddCommand(new CCgiBasicCommand(*resource));
    resource->AddCommand(new CCgiReplyCommand(*resource));
    return resource.release();
}

<font color = "red">// forward declarations </font>
void ShowCommands (const TCmdList& cmds, CCgiContext& ctx);
void ShowEntries (const TCgiEntries& entries);

int CCgiApp::ProcessRequest(CCgiContext& ctx)
{
    ShowCommands (GetResource().GetCmdList(), ctx);
    ShowEntries (const_cast&lt;TCgiEntries&>(ctx.GetRequest().GetEntries()));
    GetResource().HandleRequest(ctx);
    return 0;
}
<font color="red">
/////////////////////////////////////////////////////////////
// Define the resource's default command if none match query
</font>
CNcbiCommand* CCgiResource::GetDefaultCommand(void) const
{
    cerr << "    executing CCgiResource::GetDefaultCommand()" << endl;
    return new CCgiBasicCommand(const_cast&lt;CCgiResource&>(*this));
}

<font color="red">
///////////////////////////////////////////////////////////////
// Define the Execute() and Clone() methods for the commands </font>

void CCgiCommand::Execute(CCgiContext& ctx)
{
    cerr << "    executing CCgiCommand::Execute " << endl;
    const CNcbiRegistry& reg = ctx.GetConfig();
    ctx.GetResponse().WriteHeader();
}

CNcbiCommand* CCgiBasicCommand::Clone(void) const
{
    cerr << "    executing CCgiBasicCommand::Clone()" << endl;
    return new CCgiBasicCommand(GetCgiResource());
}

CNcbiCommand* CCgiReplyCommand::Clone(void) const
{
    cerr << "    executing CCgiReplyCommand::Clone" << endl;
    return new CCgiReplyCommand(GetCgiResource());
}

<font color = "red">// Show what commands have been installed </font>
void ShowCommands (const TCmdList& cmds, CCgiContext& ctx)
{
    cerr << "Commands defined for this application are: \n";
    for (TCmdList::const_iterator it = cmds.begin(); 
         it != cmds.end(); it++) {
         cerr << (*it)->GetName();
         if ((*it)->IsRequested(ctx)) {
            cerr << " (requested)" << endl;
         } else {
            cerr << " (not requested)" << endl;
         }
    }
}

<font color = "red">// Show the &lt;key=value> pairs in the request string </font>
void ShowEntries (const TCgiEntries& entries)
{
    cerr << "The entries in the request string were: \n";
    for (TCgiEntries::const_iterator it = entries.begin(); 
         it != entries.end(); it++) {
         if (! (it->first.empty() && it->second.empty()))
            cerr << it->first << "=" << it->second << endl;
    }
}

static CCgiApp theCgiApp;

int main(int argc, const char* argv[])
{
    SetDiagStream(&cerr);
    return theCgiApp.AppMain(argc, argv);
}
</font>
</pre>

<!--#include virtual="../ssi/footer.shtml" -->
