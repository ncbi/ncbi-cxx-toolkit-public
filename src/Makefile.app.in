#################################
# $Id$
# Author:  Denis Vakatov (vakatov@ncbi.nlm.nih.gov)
#################################
# This can be used to build/install/clean
# a single(sic!) application [APP] using [OBJ, LIB]
#
# srcdir = @srcdir@
# include @builddir@/Makefile.mk
#
# APP = my_app
# OBJ = my_main my_obj1 my_obj2
# LIB = foo bar
# .....
# CXXFLAGS = -g $(ORIG_CXXFLAGS) -D_DEBUG -DXYZ_MY_APP
# .....
# include @builddir@/Makefile.app
#################################


### C/C++ source file compilation rules

CXXFLAGS_ALL = $(CXXFLAGS) $(LOCAL_CPPFLAGS) $(CPPFLAGS)
%@obj_ext@: ./%.cpp
	$(CXX) @f_compile@ $(CXXFLAGS_ALL) $< @f_outobj@$@ $(CXX_FILTER)
%@obj_ext@: $(srcdir)/%.cpp
	$(CXX) @f_compile@ $(CXXFLAGS_ALL) $< @f_outobj@$@ $(CXX_FILTER)

CFLAGS_ALL = $(CFLAGS) $(LOCAL_CPPFLAGS) $(CPPFLAGS)
%@obj_ext@: ./%.c
	$(CC) @f_compile@ $(CFLAGS_ALL) $< @f_outobj@$@ $(CC_FILTER)
%@obj_ext@: $(srcdir)/%.c
	$(CC) @f_compile@ $(CFLAGS_ALL) $< @f_outobj@$@ $(CC_FILTER)


### Library dependencies

%.dep: $(libdir)/@lib_pre@%@lib_ext@
	@touch $@


### Standard application build rules

XAPP = $(APP)@exe_ext@
XOBJ = $(OBJ:=@obj_ext@)
XLIB = @f_libpath@$(libdir) $(LIB:%=@lib_l_pre@%@lib_l_ext@)
XLIBDEP = $(LIB:=.dep)

$(XAPP): $(XOBJ) $(XLIBDEP)
	$(LINK) $(LDFLAGS) $(XOBJ) $(PRE_LIBS) $(XLIB) $(LIBS) @f_outexe@$(XAPP)
	@$(STRIP) $(XAPP)
	$(BINCOPY) $(XAPP) $(bindir)/$(XAPP)


### Standard targets(non-recursive)

all: $(XAPP)

clean:
	-$(RMDIR) SunWS_cache
	-$(RMDIR) ii_files
	-$(RM) .make.state
	-$(RM) *@obj_ext@
	-$(RM) $(XAPP)
	-$(RM) *~
	-$(RM) *.dep
	-$(RM) core

purge: clean
	-$(RM) $(bindir)/$(XAPP)
